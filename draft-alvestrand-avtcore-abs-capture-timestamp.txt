



Audio/Video Transport Core Maintenance                     H. Alvestrand
Internet-Draft                                                    Google
Intended status: Informational                         23 September 2024
Expires: 27 March 2025


            Absolute Capture Timestamp RTP header extension
         draft-alvestrand-avtcore-abs-capture-timestamp-latest

Abstract

   This document describes an RTP header extension that can be use to
   carry information about the capture time of a video frame / audio
   sample, and include information that allows the capture time to be
   estimated by the receiver when the frame may have passed over
   multiple hops before reaching the receiver.

About This Document

   This note is to be removed before publishing as an RFC.

   The latest revision of this draft can be found at
   https://alvestrand.github.io/id-abs-capture-timestamp/draft-
   alvestrand-avtcore-abs-capture-timestamp.html.  Status information
   for this document may be found at https://datatracker.ietf.org/doc/
   draft-alvestrand-avtcore-abs-capture-timestamp/.

   Discussion of this document takes place on the Audio/Video Transport
   Core Maintenance Working Group mailing list (mailto:avt@ietf.org),
   which is archived at https://mailarchive.ietf.org/arch/browse/avt/.
   Subscribe at https://www.ietf.org/mailman/listinfo/avt/.

   Source for this draft and an issue tracker can be found at
   https://github.com/alvestrand/id-abs-capture-timestamp.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 27 March 2025.

Copyright Notice

   Copyright (c) 2024 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Definitions
   3.  Absolute Capture Time
     3.1.  RTP header extension format
       3.1.1.  Data layout overview
       3.1.2.  Data layout details
       3.1.3.  Further details
   4.  Security Considerations
   5.  IANA Considerations
   6.  Normative References
   Acknowledgments
   Author's Address

1.  Introduction

   TODO Introduction

2.  Conventions and Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  Absolute Capture Time

   The Absolute Capture Time extension is used to stamp RTP packets with
   a NTP timestamp showing when the first audio or video frame in a
   packet was originally captured.  The intent of this extension is to
   provide a way to accomplish audio-to-video synchronization when RTCP-
   terminating intermediate systems (e.g. mixers) are involved.

   *Name:* "Absolute Capture Time"; "RTP Header Extension for Absolute
   Capture Time"

   *Formal name:* http://www.webrtc.org/experiments/rtp-hdrext/abs-
   capture-time (http://www.webrtc.org/experiments/rtp-hdrext/abs-
   capture-time)

   *Status:* This extension is defined here to allow for
   experimentation.  Experience with the experiment has shown that it is
   useful; this draft therefore presents it to the IETF for
   consideration of whether to standardize it or leave it as a
   proprietary extension.

3.1.  RTP header extension format

3.1.1.  Data layout overview

   Data layout of the shortened version of abs-capture-time with a
   1-byte header + 8 bytes of data:

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  ID   | len=7 |     absolute capture timestamp (bit 0-23)     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |             absolute capture timestamp (bit 24-55)            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  ... (56-63)  |
    +-+-+-+-+-+-+-+-+

   Data layout of the extended version of abs-capture-time with a 1-byte
   header + 16 bytes of data:

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  ID   | len=15|     absolute capture timestamp (bit 0-23)     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |             absolute capture timestamp (bit 24-55)            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  ... (56-63)  |   estimated capture clock offset (bit 0-23)   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           estimated capture clock offset (bit 24-55)          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  ... (56-63)  |
    +-+-+-+-+-+-+-+-+

3.1.2.  Data layout details

   #### Absolute capture timestamp

   Absolute capture timestamp is the NTP timestamp of when the first
   frame in a packet was originally captured.  This timestamp MUST be
   based on the same clock as the clock used to generate NTP timestamps
   for RTCP sender reports on the capture system.

   It's not always possible to do an NTP clock readout at the exact
   moment of when a media frame is captured.  A capture system MAY
   postpone the readout until a more convenient time.  A capture system
   SHOULD have known delays (e.g. from hardware buffers) subtracted from
   the readout to make the final timestamp as close to the actual
   capture time as possible.

   This field is encoded as a 64-bit unsigned fixed-point number with
   the high 32 bits for the timestamp in seconds and low 32 bits for the
   fractional part.  This is also known as the UQ32.32 format and is
   what the RTP specification defines as the canonical format to
   represent NTP timestamps.

3.1.2.1.  Estimated capture clock offset

   Estimated capture clock offset is the sender's estimate of the offset
   between its own NTP clock and the capture system's NTP clock.  The
   sender is here defined as the system that owns the NTP clock used to
   generate the NTP timestamps for the RTCP sender reports on this
   stream.  The sender system is typically either the capture system or
   a mixer.

   This field is encoded as a 64-bit two’s complement *signed* fixed-
   point number with the high 32 bits for the seconds and low 32 bits
   for the fractional part.  It’s intended to make it easy for a
   receiver, that knows how to estimate the sender system’s NTP clock,
   to also estimate the capture system’s NTP clock:

    Capture NTP Clock = Sender NTP Clock + Capture Clock Offset

3.1.3.  Further details

3.1.3.1.  Capture system

   A receiver MUST treat the first CSRC in the CSRC list of a received
   packet as if it belongs to the capture system.  If the CSRC list is
   empty, then the receiver MUST treat the SSRC as if it belongs to the
   capture system.  Mixers SHOULD put the most prominent CSRC as the
   first CSRC in a packet’s CSRC list.

3.1.3.2.  Intermediate systems

   An intermediate system (e.g. mixer) MAY adjust these timestamps as
   needed.  It MAY also choose to rewrite the timestamps completely,
   using its own NTP clock as reference clock, if it wants to present
   itself as a capture system for A/V-sync purposes.

3.1.3.3.  Timestamp interpolation

   A sender SHOULD save bandwidth by not sending abs-capture-time with
   every RTP packet.  It SHOULD still send them at regular intervals
   (e.g. every second) to help mitigate the impact of clock drift and
   packet loss.  Mixers SHOULD always send abs-capture-time with the
   first RTP packet after changing capture system.

   A receiver SHOULD memorize the capture system (i.e.  CSRC/SSRC),
   capture timestamp, and RTP timestamp of the most recently received
   abs-capture-time packet on each received stream.  It can then use
   that information, in combination with RTP timestamps of packets
   without abs-capture-time, to extrapolate missing capture timestamps.

   Timestamp interpolation works fine as long as there’s reasonably low
   NTP/RTP clock drift.  This is not always true.  Senders that detect
   "jumps" between its NTP and RTP clock mappings SHOULD send abs-
   capture-time with the first RTP packet after such a thing happening.

4.  Security Considerations

   This extension carries information that may allow an attacker to
   identify different media streams on a connection.  However, this
   information is already carried in the RTP SSRC, which is not
   encrypted, so it is unlikely that much additional information is
   exposed.

5.  IANA Considerations

   If the WG decides that this extension should be registered as a
   standardized extension, IANA is requested to perform the appropriate
   registration.

   If the WG decides that this is a private extension, the URL xxxxx is
   used to identify the extension.

6.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/rfc/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/rfc/rfc8174>.

Acknowledgments

   Chen Xing, for writing the original version of this specification.

Author's Address

   Harald Alvestrand
   Google
   Email: hta@google.com
